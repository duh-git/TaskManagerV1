{% extends 'base.html' %}

{% block title %}–ú–æ–∏ –∑–∞–¥–∞—á–∏{% endblock %}

{% block content %}
<h1 class="mb-4">–ú–æ–∏ –∑–∞–¥–∞—á–∏</h1>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4">
    <div class="card-body">
        <div class="card mb-4">
            <div class="card-body">
                <form method="get" action="{% url 'task_list' %}">
                    <div class="input-group">
                        <input type="text" 
                               name="search" 
                               class="form-control" 
                               placeholder="–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é..." 
                               value="{{ request.GET.search }}">
                        <button class="btn btn-outline-secondary" type="submit">
                            <i class="bi bi-search"></i> –ù–∞–π—Ç–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <form method="get" class="row g-3">
            {% if request.GET.search %}
                <input type="hidden" name="search" value="{{ request.GET.search }}">
            {% endif %}
            <div class="col-md-3">
                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <select name="status" class="form-select">
                    <option value="">–í—Å–µ</option>
                    {% for key, value in status_choices.items %}
                        <option value="{{ key }}" 
                            {% if current_filters.status == key|stringformat:"s" %}selected{% endif %}>
                            {{ value }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                <select name="priority" class="form-select">
                    <option value="">–í—Å–µ</option>
                    {% for key, value in priority_choices.items %}
                        <option value="{{ key }}" 
                            {% if current_filters.priority == key|stringformat:"s" %}selected{% endif %}>
                            {{ value }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                <input type="date" name="due_date" class="form-control" value="{{ request.GET.due_date }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">–í–ª–∞–¥–µ–ª–µ—Ü</label>
                <select name="owner" class="form-select">
                    <option value="">–í—Å–µ</option>
                    {% for user in all_users %}
                        <option value="{{ user.username }}" 
                            {% if request.GET.owner == user.username %}selected{% endif %}>
                            {{ user.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <a href="{% url 'task_list' %}" class="btn btn-outline-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </form>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ -->
<div class="mb-4">
    <a href="{% url 'due_soon_tasks' %}" class="btn btn-info btn-sm">–ë–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π</a>
    <a href="{% url 'high_priority_tasks' %}" class="btn btn-danger btn-sm">–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</a>
    <a href="{% url 'overdue_tasks' %}" class="btn btn-dark btn-sm">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</a>
    <a href="{% url 'task_create' %}" class="btn btn-success float-end">+ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
<table class="table table-hover">
    <thead class="table-light">
        <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
            <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td><a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a></td>
            <td>{{ task.owner.username }}</td>
            <td><span class="badge bg-{% if task.status == 'C' %}success{% elif task.status == 'X' %}secondary{% else %}warning{% endif %}">
                {{ task.get_status_display }}
            </span></td>
            <td>{{ task.get_priority_display }}</td>
            <td>{{ task.due_date|date:"d.m.Y" }}</td>
            <td>
                <a href="{% url 'task_update' task.pk %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
                <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center">–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% comment %} <a href="{% url 'export_excel' %}" class="btn btn-success">
    <i class="bi bi-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
</a> {% endcomment %}
{% endblock %}